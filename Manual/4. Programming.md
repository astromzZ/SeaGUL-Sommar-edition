# Programming

## Intro

The code for the glider has been developed with the Arduino programming language through the arduino extension in VScode. The programming encompasses both code for the main micro controller (ESP32-S3) and the Artemis Global Tracker, which together makes the glider function.

## Programming setup

### Software
For the programming to work for the glider, a few steps are needed. First off you need to be able to have easy access to the github repository, the most simple way to do this is to download the Github Desktop app and follow online instructions to copy the repository toyour computer. From there you can pull changes others have made and push your own contributions. Secondly you will need a code interface, for this you should use VScode. From github desktop you will be able to link your VScode to sync your changes. 

### VScode
Your VScode will need some work before functioning properly.

1. In the extensions manager, download the Arduino extension.

2. Follow [online instruction](https://dev.to/gamegods3/how-to-install-gcc-in-windows-10-the-easier-way-422j) to download the g++/gcc compiler. 

3. Open one of the larger files eg. *glider_monterat_test3*. All of the **#includes** will be marked red, this is due to missing libraries. Click *ctrl-shift-p* and find the arduino library manager. From there you will be able to start downloading libraries which include the different header files. Some of the libraries can be hard to find, but shouldnt be more than a google search away. These libraries will probalby endup in *C:\Users\<YourUsername>\Documents\Arduino\libraries*

4. Now you will need to download the right board setups. go to ctrl-shift-p and search for **ESP32** and add that. Next do the same for the **SparkFun Apollo3 Boards**. Now you will be able to find the correct boards in the bottom right corner of VS code (**ESP32S3 Dev module** and **RedBoard Artemis ATP**).

### Using the boards
Before uploading code to the microcontrollers you will also need to go though some steps.

#### ESP32S3

1. Plugg in the microcontroller with a micro-usb cable using the 'UART' port. 
2. Change the **COM** port in VScode in the bottom right corner. VScode should only show you one option (eg. **COM4**). 
3. Change the board type to **ESP32S3 Dev Module**.

4. Change the programmer to **Esptool**

5. **Verify** the code in the top right corner. If any issues appear, resolve these (see troubleshooting section furhter down). 

6. If verified correcly hold down the **boot button** on the ESP32 and uppload using the **uppload button** in VScode. When this text appears, **release** the boot button:
> Sketch uses 1037061 bytes (79%) of program storage space. Maximum is 1310720 bytes.
Global variables use 44136 bytes (13%) of dynamic memory, leaving 283544 bytes for local variables. Maximum is 327680 bytes.
>

#### Artemis Global Tracker, AGT

1. Plugg in the microcontroller with a usb-c cable.

2. Change the **COM** port in VScode in the bottom right corner. VScode should only show you one option (eg. **COM4**). 

3. Change the board type to **RedBoard Artemis ATP (SparkFun Apollo3 Boards)**.

4. In the Board Configuration change the Baud Rate to **921600** and make sure the uploader in SparkFun Variable Loader. 

5. Change the programmer to **Ambiq secure bootloader**

6. **Verify** the code in the top right corner. If any issues appear, resolve these (see troubleshooting section). 

6. If verified correcly begin the upload. 

## Trouble shooting
With the setup complete there will still unavoidably be some issues, there are some known issues and some which will be unique to your computer and its setup.

### Known issues

### Standard trubble shooting
The most common issue is pathing to the libraries in VScode. You may need to include the libraries manually or change the directories yourself. The added libraries can as previously mentioned be found in *C:\Users\<YourUsername>\Documents\Arduino\libraries* and the standard libraries should be found in *C:\Users\<YourUsername>\AppData\Local\Arduino15*. In these directories you should be able to find the header files which are missing and manually add them to the force include. 

### c_cpp_properties.json
This file will be created the first time you compile a sketch adn create an intellisense configuration. It is here you change searched directories and other preferences. Bellow follows a snippet of an example **c_cpp_properies** that has had some troubleshooting steps. Your file shouldn't necesarilly look like this, this is just an example of how it could look after some manipulation:

    {
    "version": 4,
    "configurations": [
        {
            "name": "Win32",
            "compilerPath": "C:/MinGW/bin/gcc.exe",
            "compilerArgs": [],
            "intelliSenseMode": "gcc-x64",
            "includePath": [
                "${workspaceFolder}/**",
                "C:/Users/oskar/AppData/Local/Arduino15/packages/esp32/**",
                "C:/Users/oskar/AppData/Local/Arduino15/packages/arduino/**",
                "C:/Users/oskar/AppData/Local/Arduino15/packages/sparkfun/**",
                "C:/Users/oskar/AppData/Local/Arduino15/packages/SparkFun/hardware/apollo3/2.2.1/cores/arduino/mbed-bridge/core-api/api/deprecated-avr-comp/avr/**",
                "C:/Users/oskar/AppData/Local/Arduino15/**",
                "C:/Users/oskar/Documents/Arduino/libraries **"
            ],
            "browse": {
                "path": [
                    "${workspaceFolder}",
                    "C:/Users/oskar/Documents/Arduino/libraries/**",
                    "C:/Users/oskar/AppData/Local/Arduino15/packages/esp32/**",
                    "C:/Users/oskar/AppData/Local/Arduino15/packages/arduino/**",
                    "C:/Users/oskar/AppData/Local/Arduino15/packages/sparkfun/**",
                    "C:/Users/oskar/AppData/Local/Arduino15/**"
                ],
                "limitSymbolsToIncludedHeaders": true,
                "databaseFilename": ""
            },
                
                
            
            "forcedInclude": [
                "C:/Users/oskar/AppData/Local/Arduino15/packages/esp32/hardware/esp32/3.0.3/libraries/Wire/src/Wire.h",
                "C:/Users/oskar/AppData/Local/Arduino15/packages/esp32/tools/esp-rv32/2302/lib/gcc/riscv32-esp-elf/12.2.0/include-fixed/limits.h"
            ],
            "cStandard": "c17",
            "cppStandard": "gnu++17",
            "defines": [
                "USBCON",
                "_DEBUG",
                "UNICODE",
                "_UNICODE",
                "ARDUINO=10812"
            ]
        },